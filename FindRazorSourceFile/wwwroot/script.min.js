const a={openInVSCode:!1},ot="razorsource:options",c="NotFound",e="none",n=null,v="./_content/FindRazorSourceFile/",it="findrazorsourcefile-ui",o=document,b=Node.COMMENT_NODE,st=Node.ELEMENT_NODE,ht={top:9999999,left:9999999,bottom:0,right:0};let ct=!1,y=n,p=n,t,s=n,f=n,k=n,i=n;const rt={};let r=0;const d=n=>Array.isArray(n),lt=n=>n.reduce((n,t)=>({top:Math.min(n.top,t.top),left:Math.min(n.left,t.left),bottom:Math.max(n.bottom,t.bottom),right:Math.max(n.right,t.right)}),ht),l=(n,t)=>{for(let i in t)n.addEventListener(i,t[i])},w=(n,t)=>{for(let i in t)n.removeEventListener(i,t[i])},h=n=>n.stopPropagation(),g=(n,t)=>Object.assign(n.style,t),u=(n,t,i,r)=>{let u={};const f=o.createElement(n);t&&g(f,t);i&&Object.assign(f,i);const e=([n,t])=>(f.appendChild(n),u={...u,...t},n);return r?.forEach(n=>{if(d(n))e(n);else for(let t in n){const i=e(n[t]);u[t]=i}}),[f,u]};export const init=()=>{if(!ct){ct=!0;ni();ti();customElements.define(it,ii);const n=()=>{if(!document.body.querySelector(it)){const[n]=u(it);o.body.appendChild(n)}};Blazor.addEventListener("enhancedload",n);n();l(o,{keydown:ui});l(window,{resize:si,storage:hi})}};const ni=async()=>{const t=n=>n.textContent?.trim().match(/^(begin|end):(frsf-[a-z0-9]{10})$/)||[],u=n=>{let t=0;while(n)t++,n=n.parentElement;return t},i=[],r=o.createTreeWalker(o.body,NodeFilter.SHOW_COMMENT,n);while(r.nextNode()){const o=r.currentNode,[,h,s]=t(o);if(h==="begin"){const f=await ft(s);if(f&&f!==c){let n=o.nextSibling;const e=[];while(n){if(n.nodeType===st&&e.push(n),n.nodeType===b){const[,r,o]=t(n);if(r==="end"&&o===s){i.push({boundaryRect:lt(e.map(n=>n.getBoundingClientRect())),depth:Math.min(...e.map(u)),source:f});break}}n=n.nextSibling}}}}return i},ti=()=>{const t=o.createTreeWalker(o.body,NodeFilter.SHOW_COMMENT,n);while(t.nextNode()){const n=t.currentNode;if(n.textContent==="!"){const i=Object.getOwnPropertySymbols(n);if(i.forEach(t=>{const i=n[t];y||typeof i.nodeType===undefined||(y=t);!p&&d(i)&&(p=t)}),y&&p)break}}};class ii extends HTMLElement{constructor(){super()}connectedCallback(){const i=this.attachShadow({mode:"open"}),n=ri(i);t=n;nt(1);l(n.overlay,{mousemove:vt,click:ut});l(n.sourceNameTip,{mousemove:h,click:yt});l(n.settingsButton,{click:pt});l(n.settingsForm,{click:h});l(n.settingsOpenInVSCode,{click:wt});gt();this.dispose=()=>{w(n.overlay,{mousemove:vt,click:ut}),w(n.sourceNameTip,{mousemove:h,click:yt}),w(n.settingsButton,{click:pt}),w(n.settingsForm,{click:h}),w(n.settingsOpenInVSCode,{click:wt})}}disconnectedCallback(){this.dispose?.()}}const ri=t=>{const[i,r]=u("div",{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",zIndex:"9999",backgroundColor:"transparent",borderStyle:"solid",display:e,opacity:"0",transition:"border 0.2s ease-out, box-shadow 0.2s ease-out, opacity 0.2s linear"},n,[{sourceNameTip:u("div",{position:"absolute",top:"4px",left:"4px",padding:"2px 6px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",backgroundColor:"#ffc107",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",whiteSpace:"nowrap",display:e,transition:"opacity 0.2s ease-out"},n,[u("img",{verticalAlign:"middle",width:"16px"},{src:v+"ASPWebApplication_16x.svg"}),{sourceNameTipProjectName:u("span",{verticalAlign:"middle",marginLeft:"4px"})},u("span",{verticalAlign:"middle"},{textContent:" | "}),u("img",{verticalAlign:"middle",width:"16px"},{src:v+"ASPRazorFile_16x.svg"}),{sourceNameTipItemName:u("span",{verticalAlign:"middle",marginLeft:"4px"})}])},{settingsButton:u("button",{position:"fixed",bottom:"8px",right:"8px",height:"32px",paddingLeft:"30px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",border:e,backgroundColor:"#fff",borderRadius:"64px",outline:e,backgroundImage:`url('${v}settings_black_24dp.svg')`,backgroundRepeat:"no-repeat",backgroundPosition:"5px center"},{title:"Find Razor Source File - Settings",textContent:"Find Razor Source File"})},{settingsForm:u("div",{position:"fixed",bottom:"0",right:"8px",padding:"8px 12px",border:"#ccc",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",opacity:"0",transition:"ease-out all 0.2s",pointerEvents:e},n,[u("label",{margin:"0",padding:"0",fontFamily:"sans-serif",fontSize:"12px",color:"#111"},n,[{settingsOpenInVSCode:u("input",{margin:"0 8px 0 0",padding:"0",verticalAlign:"middle"},{type:"checkbox"})},u("span",{verticalAlign:"middle"},{textContent:"Open the .razor file of the clicked component in "}),u("img",{verticalAlign:"middle",width:"18px"},{src:v+"vscode.svg"}),u("span",{verticalAlign:"middle"},{textContent:" VSCode"}),])])}]);return t.appendChild(i),{...{overlay:i},...r}},nt=n=>{const i=n===1?.3:.5,r=n===1?"0.8":"1.0";g(t.overlay,{borderColor:`rgba(0, 0, 0, ${i})`,boxShadow:`inset rgb(0, 0, 0, ${i}) 0px 0px 6px 4px`});t.sourceNameTip.style.opacity=r},at=(n,i)=>{t.sourceNameTipProjectName.textContent=n,t.sourceNameTipItemName.textContent=i},ui=u=>{const o=u.code==="KeyF"&&u.ctrlKey&&u.shiftKey&&!u.metaKey&&!u.altKey,s=u.code==="Escape"&&!u.ctrlKey&&!u.shiftKey&&!u.metaKey&&!u.altKey;r===0&&o?(h(u),u.preventDefault(),r=1,g(t.overlay,{borderWidth:"50vh 50vw",display:"block"}),tt(),setTimeout(()=>{(r===1||r===2)&&(t.overlay.style.opacity="1")},1),at("",""),f=n,k=n,i=n):(r===1||r===2)&&(s||o)&&(h(u),u.preventDefault(),r=o?0:r===2?1:0,nt(1),t.sourceNameTip.style.display=e,t.overlay.style.borderWidth="50vh 50vw",tt(),r===0&&(t.overlay.style.opacity="0",setTimeout(()=>{r===0&&(t.overlay.style.display=e)},200)))},vt=async n=>{r===1&&bt(n)},ut=n=>{if(tt(),r===1){if(f&&s&&s!==c){r=2;nt(2);const n=new Event("razorsource:lockin",{bubbles:!1,cancelable:!1});n.razorSourceName=s;o.dispatchEvent(n);a.openInVSCode&&(window.location.href=`vscode://file/${s.fullPath}`)}}else r===2&&(r=1,nt(1),bt(n))},yt=n=>{h(n),r===1&&ut(n)},pt=n=>{h(n),ei()?fi():tt()},fi=()=>Object.assign(t.settingsForm.style,{opacity:"1",bottom:"48px",pointerEvents:"unset"}),tt=()=>Object.assign(t.settingsForm.style,{opacity:"0",bottom:"0",pointerEvents:e}),ei=()=>t.settingsForm.style.opacity==="0",wt=n=>{h(n),a.openInVSCode=t.settingsOpenInVSCode.checked,ci()},bt=async n=>{const t=await oi(n);t.scopeHasChanged!==!1&&(s=await ft(t.scope),dt(t.scopeRect,s))},oi=async r=>{t.overlay.style.visibility="hidden";const c=o.elementFromPoint(r.clientX,r.clientY);t.overlay.style.visibility="visible";let u=n,e=n;for(let n=c;n;n=n.parentElement)u?u===await kt(n)&&(e=n):(u=await kt(n),u&&(e=n));let s=n;if(u&&e){if(f&&f!==u&&i&&i.left<r.clientX&&r.clientX<i.right&&i.top<r.clientY&&r.clientY<i.bottom&&(s=et(e),s.left<i.left&&s.right>i.right&&s.top<i.top&&s.bottom>i.bottom))return{scope:f,scopeRect:i,scopeHasChanged:!1}}else if(i&&i.left<r.clientX&&r.clientX<i.right&&i.top<r.clientY&&r.clientY<i.bottom)return{scope:f,scopeRect:i,scopeHasChanged:!1};const h=f!==u;return h&&(f=u,k=e,i=s||(e?et(e):n)),{scope:f,scopeRect:i,scopeHasChanged:h}},kt=async t=>{const i=t.getAttributeNames().filter(n=>n.startsWith("b-"))[0]||n,r=await ft(i);return!r||r===c?n:i},ft=async t=>{if(!t)return n;let i=rt[t]||n;if(i)return i;const r=await fetch(`${v}RazorSourceMapFiles/${t}.txt`);if(r.ok){const u=await r.text(),n=u.replace(/[\r\n]*$/ig,"").split("|"),i={projectName:n[0],itemName:n[1],fullPath:n[2]};return rt[t]=i,i}return rt[t]=c,c},dt=(n,i)=>{if(!n||!i||i===c){t.sourceNameTip.style.display=e;t.overlay.style.borderWidth="50vh 50vw";return}const r=t.overlay.getBoundingClientRect();g(t.overlay,{borderStyle:"solid",borderTopWidth:n.top+"px",borderLeftWidth:n.left+"px",borderBottomWidth:r.height-n.bottom+"px",borderRightWidth:r.width-n.right+"px"});at(i.projectName,i.itemName);t.sourceNameTip.style.display="block"},et=t=>{const i=t=>{const i=[n,[]];if(!y||!p)return i;const r=t[y],u=t[p];return d(r)||!r?i:!d(u)||!u?i:[r,u]},u=n=>{const[t,r]=i(n);if(t?.nodeType===b){const[,r]=i(t);return[...r,n]}return n.nodeType===b?[...r,n]:[n]},r=n=>lt(n.map(n=>n.nodeType===st?n.getBoundingClientRect():n.nodeType===b?r(i(n)[1]):ht));return r(u(t))},si=()=>{r!==0&&f&&k&&i&&s&&s!==c&&(i=et(k),dt(i,s))},hi=()=>gt(),ci=()=>{const n=JSON.stringify(a);localStorage.setItem(ot,n)},gt=()=>{const n=localStorage.getItem(ot);Object.assign(a,JSON.parse(n||"{}"));t.settingsOpenInVSCode.checked=a.openInVSCode};