const a={openInVSCode:!1},ct="razorsource:options",c="NotFound",e="none",n=null,v="./_content/FindRazorSourceFile/",rt="findrazorsourcefile-ui",o=document,b=Node.COMMENT_NODE,lt=Node.ELEMENT_NODE,ut={top:9999999,left:9999999,bottom:0,right:0};let at=!1,y=n,p=n,t,s=n,ft=[],f=n,et=[],r=n;const ot={};let i=0;const k=n=>Array.isArray(n),d=n=>n.reduce((n,t)=>({top:Math.min(n.top,t.top),left:Math.min(n.left,t.left),bottom:Math.max(n.bottom,t.bottom),right:Math.max(n.right,t.right)}),ut),st=(n,t)=>t!==null&&t.left<n.clientX&&n.clientX<t.right&&t.top<n.clientY&&n.clientY<t.bottom,vt=n=>{let t=0;while(n)t++,n=n.parentElement;return t},l=(n,t)=>{for(let i in t)n.addEventListener(i,t[i])},w=(n,t)=>{for(let i in t)n.removeEventListener(i,t[i])},h=n=>n.stopPropagation(),g=(n,t)=>Object.assign(n.style,t),u=(n,t,i,r)=>{let u={};const f=o.createElement(n);t&&g(f,t);i&&Object.assign(f,i);const e=([n,t])=>(f.appendChild(n),u={...u,...t},n);return r?.forEach(n=>{if(k(n))e(n);else for(let t in n){const i=e(n[t]);u[t]=i}}),[f,u]};export const init=()=>{if(!at){at=!0;ui();customElements.define(rt,fi);const n=()=>{if(!document.body.querySelector(rt)){const[n]=u(rt);o.body.appendChild(n)}};Blazor.addEventListener("enhancedload",n);n();l(o,{keydown:oi});l(window,{resize:li,storage:ai})}};const ri=async()=>{const t=n=>n.textContent?.trim().match(/^(begin|end):(frsf-[a-z0-9]{10})$/)||[],i=[],r=o.createTreeWalker(o.body,NodeFilter.SHOW_COMMENT,n);while(r.nextNode()){const o=r.currentNode,[,s,f]=t(o);if(s==="begin"){const e=await it(f);if(e&&e!==c){let n=o.nextSibling;const u=[];while(n){if(n.nodeType===lt&&u.push(n),n.nodeType===b){const[,r,o]=t(n);if(r==="end"&&o===f&&u.length>0){i.push({hash:f,rect:d(u.map(n=>n.getBoundingClientRect())),depth:Math.min(...u.map(vt)),source:e,elements:u});break}}n=n.nextSibling}}}}return i},ui=()=>{const t=o.createTreeWalker(o.body,NodeFilter.SHOW_COMMENT,n);while(t.nextNode()){const n=t.currentNode;if(n.textContent==="!"){const i=Object.getOwnPropertySymbols(n);if(i.forEach(t=>{const i=n[t];y||typeof i.nodeType===undefined||(y=t);!p&&k(i)&&(p=t)}),y&&p)break}}};class fi extends HTMLElement{constructor(){super()}connectedCallback(){const i=this.attachShadow({mode:"open"}),n=ei(i);t=n;nt(1);l(n.overlay,{mousemove:pt,click:ht});l(n.sourceNameTip,{mousemove:h,click:wt});l(n.settingsButton,{click:bt});l(n.settingsForm,{click:h});l(n.settingsOpenInVSCode,{click:kt});ii();this.dispose=()=>{w(n.overlay,{mousemove:pt,click:ht}),w(n.sourceNameTip,{mousemove:h,click:wt}),w(n.settingsButton,{click:bt}),w(n.settingsForm,{click:h}),w(n.settingsOpenInVSCode,{click:kt})}}disconnectedCallback(){this.dispose?.()}}const ei=t=>{const[i,r]=u("div",{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",zIndex:"9999",backgroundColor:"transparent",borderStyle:"solid",display:e,opacity:"0",transition:"border 0.2s ease-out, box-shadow 0.2s ease-out, opacity 0.2s linear"},n,[{sourceNameTip:u("div",{position:"absolute",top:"4px",left:"4px",padding:"2px 6px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",backgroundColor:"#ffc107",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",whiteSpace:"nowrap",display:e,transition:"opacity 0.2s ease-out"},n,[u("img",{verticalAlign:"middle",width:"16px"},{src:v+"ASPWebApplication_16x.svg"}),{sourceNameTipProjectName:u("span",{verticalAlign:"middle",marginLeft:"4px"})},u("span",{verticalAlign:"middle"},{textContent:" | "}),u("img",{verticalAlign:"middle",width:"16px"},{src:v+"ASPRazorFile_16x.svg"}),{sourceNameTipItemName:u("span",{verticalAlign:"middle",marginLeft:"4px"})}])},{settingsButton:u("button",{position:"fixed",bottom:"8px",right:"8px",height:"32px",paddingLeft:"30px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",border:e,backgroundColor:"#fff",borderRadius:"64px",outline:e,backgroundImage:`url('${v}settings_black_24dp.svg')`,backgroundRepeat:"no-repeat",backgroundPosition:"5px center"},{title:"Find Razor Source File - Settings",textContent:"Find Razor Source File"})},{settingsForm:u("div",{position:"fixed",bottom:"0",right:"8px",padding:"8px 12px",border:"#ccc",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",opacity:"0",transition:"ease-out all 0.2s",pointerEvents:e},n,[u("label",{margin:"0",padding:"0",fontFamily:"sans-serif",fontSize:"12px",color:"#111"},n,[{settingsOpenInVSCode:u("input",{margin:"0 8px 0 0",padding:"0",verticalAlign:"middle"},{type:"checkbox"})},u("span",{verticalAlign:"middle"},{textContent:"Open the .razor file of the clicked component in "}),u("img",{verticalAlign:"middle",width:"18px"},{src:v+"vscode.svg"}),u("span",{verticalAlign:"middle"},{textContent:" VSCode"}),])])}]);return t.appendChild(i),{...{overlay:i},...r}},nt=n=>{const i=n===1?.3:.5,r=n===1?"0.8":"1.0";g(t.overlay,{borderColor:`rgba(0, 0, 0, ${i})`,boxShadow:`inset rgb(0, 0, 0, ${i}) 0px 0px 6px 4px`});t.sourceNameTip.style.opacity=r},yt=(n,i)=>{t.sourceNameTipProjectName.textContent=n,t.sourceNameTipItemName.textContent=i},oi=async u=>{const o=u.code==="KeyF"&&u.ctrlKey&&u.shiftKey&&!u.metaKey&&!u.altKey,s=u.code==="Escape"&&!u.ctrlKey&&!u.shiftKey&&!u.metaKey&&!u.altKey;i===0&&o?(h(u),u.preventDefault(),ft=await ri(),i=1,g(t.overlay,{borderWidth:"50vh 50vw",display:"block"}),tt(),setTimeout(()=>{(i===1||i===2)&&(t.overlay.style.opacity="1")},1),yt("",""),f=n,et=[],r=n):(i===1||i===2)&&(s||o)&&(h(u),u.preventDefault(),i=o?0:i===2?1:0,nt(1),t.sourceNameTip.style.display=e,t.overlay.style.borderWidth="50vh 50vw",tt(),i===0&&(ft=[],t.overlay.style.opacity="0",setTimeout(()=>{i===0&&(t.overlay.style.display=e)},200)))},pt=async n=>{i===1&&dt(n)},ht=n=>{if(tt(),i===1){if(f&&s&&s!==c){i=2;nt(2);const n=new Event("razorsource:lockin",{bubbles:!1,cancelable:!1});n.razorSourceName=s;o.dispatchEvent(n);a.openInVSCode&&(window.location.href=`vscode://file/${s.fullPath}`)}}else i===2&&(i=1,nt(1),dt(n))},wt=n=>{h(n),i===1&&ht(n)},bt=n=>{h(n),hi()?si():tt()},si=()=>Object.assign(t.settingsForm.style,{opacity:"1",bottom:"48px",pointerEvents:"unset"}),tt=()=>Object.assign(t.settingsForm.style,{opacity:"0",bottom:"0",pointerEvents:e}),hi=()=>t.settingsForm.style.opacity==="0",kt=n=>{h(n),a.openInVSCode=t.settingsOpenInVSCode.checked,vi()},dt=async n=>{const t=await ci(n);t.scopeHasChanged!==!1&&(s=await it(t),ni(t.scopeRect,s))},ci=async i=>{t.overlay.style.visibility="hidden";const y=o.elementFromPoint(i.clientX,i.clientY);t.overlay.style.visibility="visible";let u=n,e=n,l=n,a=[],h=n;for(let n=y;n;n=n.parentElement)u?u===await gt(n)&&(h=n):(u=await gt(n),u&&(h=n));u&&h&&(a=[h],e=(f===u?r:n)||ti(h),l=await it(u));const s=ft.filter(n=>st(i,n.rect)).sort((n,t)=>t.depth-n.depth)[0];if(s){let n=!1;u?h&&l&&(l!==c&&l.itemName===s.source.itemName?(e=d([e||ut,s.rect]),console.log(`COMBINE RECTS:`,e),a=[h,...s.elements]):vt(h)<s.depth&&(n=!0)):n=!0;n&&(u=s.hash,a=s.elements,e=s.rect,l=s.source)}if(u&&e){if(f&&f!==u&&r&&st(i,r)&&e.left<r.left&&e.right>r.right&&e.top<r.top&&e.bottom>r.bottom)return{scope:f,scopeRect:r,scopeHasChanged:!1}}else if(st(i,r))return{scope:f,scopeRect:r,scopeHasChanged:!1};const v=f!==u;return v&&(f=u,et=a,r=e),{scope:f,scopeRect:r,scopeHasChanged:v,source:l}},gt=async t=>{const i=t.getAttributeNames().filter(n=>n.startsWith("b-"))[0]||n,r=await it(i);return!r||r===c?n:i},it=async t=>{if(t&&typeof t!="string"&&t.source)return t.source;const i=typeof t=="string"?t:t?.scope||n;if(!i)return n;let r=ot[i]||n;if(r)return r;const u=await fetch(`${v}RazorSourceMapFiles/${i}.txt`);if(u.ok){const r=await u.text(),n=r.replace(/[\r\n]*$/ig,"").split("|"),t={projectName:n[0],itemName:n[1],fullPath:n[2]};return ot[i]=t,t}return ot[i]=c,c},ni=(n,i)=>{if(!n||!i||i===c){t.sourceNameTip.style.display=e;t.overlay.style.borderWidth="50vh 50vw";return}const r=t.overlay.getBoundingClientRect();g(t.overlay,{borderStyle:"solid",borderTopWidth:n.top+"px",borderLeftWidth:n.left+"px",borderBottomWidth:r.height-n.bottom+"px",borderRightWidth:r.width-n.right+"px"});yt(i.projectName,i.itemName);t.sourceNameTip.style.display="block"},ti=t=>{const i=t=>{const i=[n,[]];if(!y||!p)return i;const r=t[y],u=t[p];return k(r)||!r?i:!k(u)||!u?i:[r,u]},u=n=>{const[t,r]=i(n);if(t?.nodeType===b){const[,r]=i(t);return[...r,n]}return n.nodeType===b?[...r,n]:[n]},r=n=>d(n.map(n=>n.nodeType===lt?n.getBoundingClientRect():n.nodeType===b?r(i(n)[1]):ut));return r(u(t))},li=()=>{i!==0&&f&&r&&s&&s!==c&&(r=d(et.map(n=>ti(n))),ni(r,s))},ai=()=>ii(),vi=()=>{const n=JSON.stringify(a);localStorage.setItem(ct,n)},ii=()=>{const n=localStorage.getItem(ct);Object.assign(a,JSON.parse(n||"{}"));t.settingsOpenInVSCode.checked=a.openInVSCode};