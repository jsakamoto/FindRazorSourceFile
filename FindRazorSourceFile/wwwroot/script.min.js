const a={openInVSCode:!1},ct="razorsource:options",c="NotFound",e="none",t=null,v="./_content/FindRazorSourceFile/",rt="findrazorsourcefile-ui",o=document,k=Node.COMMENT_NODE,lt=Node.ELEMENT_NODE,ut={top:Number.MAX_SAFE_INTEGER,left:Number.MAX_SAFE_INTEGER,bottom:Number.MIN_SAFE_INTEGER,right:Number.MIN_SAFE_INTEGER};let at=!1,y=t,p=t,n,s=t,ft=[],f=t,et=[],r=t;const ot={};let i=0;const d=n=>Array.isArray(n),g=n=>n.reduce((n,t)=>({top:Math.min(n.top,t.top),left:Math.min(n.left,t.left),bottom:Math.max(n.bottom,t.bottom),right:Math.max(n.right,t.right)}),ut),st=(n,t)=>t!==null&&t.left<n.clientX&&n.clientX<t.right&&t.top<n.clientY&&n.clientY<t.bottom,vt=n=>{let t=0;while(n)t++,n=n.parentElement;return t},l=(n,t)=>{for(let i in t)n.addEventListener(i,t[i])},w=(n,t)=>{for(let i in t)n.removeEventListener(i,t[i])},h=n=>n.stopPropagation(),b=(n,t)=>Object.assign(n.style,t),u=(n,t,i,r)=>{let u={};const f=o.createElement(n);t&&b(f,t);i&&Object.assign(f,i);const e=([n,t])=>(f.appendChild(n),u={...u,...t},n);return r?.forEach(n=>{if(d(n))e(n);else for(let t in n){const i=e(n[t]);u[t]=i}}),[f,u]};export const init=()=>{if(!at){at=!0;fi();customElements.define(rt,ei);const n=()=>{if(!document.body.querySelector(rt)){const[n]=u(rt);o.body.appendChild(n)}};Blazor.addEventListener("enhancedload",n);n();l(o,{keydown:si});l(window,{resize:ii,scroll:ii,storage:ai})}};const ui=async()=>{const n=n=>n.textContent?.trim().match(/^(begin|end):(frsf-[a-z0-9]{10})$/)||[],i=[],r=o.createTreeWalker(o.body,NodeFilter.SHOW_COMMENT,t);while(r.nextNode()){const o=r.currentNode,[,s,f]=n(o);if(s==="begin"){const e=await it(f);if(e&&e!==c){let t=o.nextSibling;const u=[];while(t){if(t.nodeType===lt&&u.push(t),t.nodeType===k){const[,r,o]=n(t);if(r==="end"&&o===f&&u.length>0){i.push({hash:f,rect:()=>g(u.map(n=>n.getBoundingClientRect())),depth:Math.min(...u.map(vt)),source:e,elements:u});break}}t=t.nextSibling}}}}return i},fi=()=>{const n=o.createTreeWalker(o.body,NodeFilter.SHOW_COMMENT,t);while(n.nextNode()){const t=n.currentNode;if(t.textContent==="!"){const i=Object.getOwnPropertySymbols(t);if(i.forEach(n=>{const i=t[n];i&&(d(i)?p=p||n:typeof i.nodeType!==undefined&&(y=y||n))}),y&&p)break}}};class ei extends HTMLElement{constructor(){super()}connectedCallback(){const i=this.attachShadow({mode:"open"}),t=oi(i);n=t;nt(1);l(t.overlay,{mousemove:pt,click:ht});l(t.sourceNameTip,{mousemove:h,click:wt});l(t.settingsButton,{click:bt});l(t.settingsForm,{click:h});l(t.settingsOpenInVSCode,{click:kt});ri();this.dispose=()=>{w(t.overlay,{mousemove:pt,click:ht}),w(t.sourceNameTip,{mousemove:h,click:wt}),w(t.settingsButton,{click:bt}),w(t.settingsForm,{click:h}),w(t.settingsOpenInVSCode,{click:kt})}}disconnectedCallback(){this.dispose?.()}}const oi=n=>{const[i,r]=u("div",{position:"fixed",top:"0",left:"0",bottom:"0",right:"0",zIndex:"9999",backgroundColor:"transparent",borderStyle:"solid",display:e,opacity:"0",transition:"border 0.2s ease-out, box-shadow 0.2s ease-out, opacity 0.2s linear"},t,[{sourceNameTip:u("div",{position:"absolute",top:"4px",left:"4px",padding:"2px 6px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",backgroundColor:"#ffc107",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",whiteSpace:"nowrap",display:e,transition:"opacity 0.2s ease-out",pointerEvents:e},t,[u("img",{verticalAlign:"middle",width:"16px"},{src:v+"ASPWebApplication_16x.svg"}),{sourceNameTipProjectName:u("span",{verticalAlign:"middle",marginLeft:"4px"})},u("span",{verticalAlign:"middle"},{textContent:" | "}),u("img",{verticalAlign:"middle",width:"16px"},{src:v+"ASPRazorFile_16x.svg"}),{sourceNameTipItemName:u("span",{verticalAlign:"middle",marginLeft:"4px"})}])},{settingsButton:u("button",{position:"fixed",bottom:"8px",right:"8px",height:"32px",paddingLeft:"30px",fontFamily:"sans-serif",fontSize:"12px",color:"#111",border:e,backgroundColor:"#fff",borderRadius:"64px",outline:e,backgroundImage:`url('${v}settings_black_24dp.svg')`,backgroundRepeat:"no-repeat",backgroundPosition:"5px center"},{title:"Find Razor Source File - Settings",textContent:"Find Razor Source File"})},{settingsForm:u("div",{position:"fixed",bottom:"0",right:"8px",padding:"8px 12px",border:"#ccc",backgroundColor:"#fff",borderRadius:"8px",boxShadow:"2px 2px 4px 0px rgb(0, 0, 0, 0.5)",opacity:"0",transition:"ease-out all 0.2s",pointerEvents:e},t,[u("label",{margin:"0",padding:"0",fontFamily:"sans-serif",fontSize:"12px",color:"#111"},t,[{settingsOpenInVSCode:u("input",{margin:"0 8px 0 0",padding:"0",verticalAlign:"middle"},{type:"checkbox"})},u("span",{verticalAlign:"middle"},{textContent:"Open the .razor file of the clicked component in "}),u("img",{verticalAlign:"middle",width:"18px"},{src:v+"vscode.svg"}),u("span",{verticalAlign:"middle"},{textContent:" VSCode"}),])])}]);return n.appendChild(i),{...{overlay:i},...r}},nt=t=>{const i=t===1?.3:.5,r=t===1?"0.8":"1.0";b(n.overlay,{borderColor:`rgba(0, 0, 0, ${i})`,boxShadow:`inset rgb(0, 0, 0, ${i}) 0px 0px 6px 4px`});b(n.sourceNameTip,{opacity:r,pointerEvents:t===2?"auto":"none"})},yt=(t,i)=>{n.sourceNameTipProjectName.textContent=t,n.sourceNameTipItemName.textContent=i},si=async u=>{const o=u.code==="KeyF"&&u.ctrlKey&&u.shiftKey&&!u.metaKey&&!u.altKey,s=u.code==="Escape"&&!u.ctrlKey&&!u.shiftKey&&!u.metaKey&&!u.altKey;i===0&&o?(h(u),u.preventDefault(),ft=await ui(),i=1,b(n.overlay,{borderWidth:"50vh 50vw",display:"block"}),tt(),setTimeout(()=>{(i===1||i===2)&&(n.overlay.style.opacity="1")},1),yt("",""),f=t,et=[],r=t):(i===1||i===2)&&(s||o)&&(h(u),u.preventDefault(),i=o?0:i===2?1:0,nt(1),n.sourceNameTip.style.display=e,n.overlay.style.borderWidth="50vh 50vw",tt(),i===0&&(ft=[],n.overlay.style.opacity="0",setTimeout(()=>{i===0&&(n.overlay.style.display=e)},200)))},pt=async n=>{i===1&&dt(n)},ht=n=>{if(tt(),i===1){if(f&&s&&s!==c){i=2;nt(2);const n=new Event("razorsource:lockin",{bubbles:!1,cancelable:!1});n.razorSourceName=s;o.dispatchEvent(n);a.openInVSCode&&(window.location.href=`vscode://file/${s.fullPath}`)}}else i===2&&(i=1,nt(1),dt(n))},wt=n=>{h(n),i===1&&ht(n)},bt=n=>{h(n),ci()?hi():tt()},hi=()=>Object.assign(n.settingsForm.style,{opacity:"1",bottom:"48px",pointerEvents:"unset"}),tt=()=>Object.assign(n.settingsForm.style,{opacity:"0",bottom:"0",pointerEvents:e}),ci=()=>n.settingsForm.style.opacity==="0",kt=t=>{h(t),a.openInVSCode=n.settingsOpenInVSCode.checked,vi()},dt=async n=>{const t=await li(n);t.scopeHasChanged!==!1&&(s=await it(t),ni(t.scopeRect,s))},li=async i=>{const y=n.sourceNameTip.style.visibility;n.sourceNameTip.style.visibility="hidden";n.overlay.style.visibility="hidden";const p=o.elementFromPoint(i.clientX,i.clientY);n.overlay.style.visibility="visible";n.sourceNameTip.style.visibility=y;let u=t,e=t,l=t,a=[],h=t;for(let n=p;n;n=n.parentElement)u?u===await gt(n)&&(h=n):(u=await gt(n),u&&(h=n));u&&h&&(a=[h],e=(f===u?r:t)||ti(h),l=await it(u));const s=ft.filter(n=>st(i,n.rect())).sort((n,t)=>t.depth!==n.depth?t.depth-n.depth:n.elements.length-t.elements.length)[0];if(s){let n=!1;u?h&&l&&(l!==c&&l.itemName===s.source.itemName?(e=g([e||ut,s.rect()]),a=[h,...s.elements]):vt(h)<s.depth&&(n=!0)):n=!0;n&&(u=s.hash,a=s.elements,e=s.rect(),l=s.source)}if(u&&e){if(f&&f!==u&&r&&st(i,r)&&e.left<r.left&&e.right>r.right&&e.top<r.top&&e.bottom>r.bottom)return{scope:f,scopeRect:r,scopeHasChanged:!1}}else if(st(i,r))return{scope:f,scopeRect:r,scopeHasChanged:!1};const v=f!==u;return v&&(f=u,et=a,r=e),{scope:f,scopeRect:r,scopeHasChanged:v,source:l}},gt=async n=>{const i=n.getAttributeNames().filter(n=>n.startsWith("b-"))[0]||t,r=await it(i);return!r||r===c?t:i},it=async n=>{if(n&&typeof n!="string"&&n.source)return n.source;const i=typeof n=="string"?n:n?.scope||t;if(!i)return t;let r=ot[i]||t;if(r)return r;const u=await fetch(`${v}RazorSourceMapFiles/${i}.txt`);if(u.ok){const r=await u.text(),n=r.replace(/[\r\n]*$/ig,"").split("|"),t={projectName:n[0],itemName:n[1],fullPath:n[2]};return ot[i]=t,t}return ot[i]=c,c},ni=(t,i)=>{if(!t||!i||i===c){n.sourceNameTip.style.display=e;n.overlay.style.borderWidth="50vh 50vw";return}const r=n.overlay.getBoundingClientRect(),u=r.height-t.bottom,f=r.width-t.right;b(n.overlay,{borderStyle:"solid",borderTopWidth:t.top>0?t.top+"px":0,borderLeftWidth:t.left>0?t.left+"px":0,borderBottomWidth:u>0?u+"px":0,borderRightWidth:f>0?f+"px":0});yt(i.projectName,i.itemName);n.sourceNameTip.style.display="block"},ti=n=>{const i=n=>{const i=[t,[]];if(!y||!p)return i;const r=n[y],u=n[p];return d(r)||!r?i:!d(u)||!u?i:[r,u]},u=n=>{const[t,r]=i(n);if(t?.nodeType===k){const[,r]=i(t);return[...r,n]}return n.nodeType===k?[...r,n]:[n]},r=n=>g(n.map(n=>n.nodeType===lt?n.getBoundingClientRect():n.nodeType===k?r(i(n)[1]):ut));return r(u(n))},ii=()=>{i!==0&&f&&r&&s&&s!==c&&(r=g(et.map(n=>ti(n))),ni(r,s))},ai=()=>ri(),vi=()=>{const n=JSON.stringify(a);localStorage.setItem(ct,n)},ri=()=>{const t=localStorage.getItem(ct);Object.assign(a,JSON.parse(t||"{}"));n.settingsOpenInVSCode.checked=a.openInVSCode};